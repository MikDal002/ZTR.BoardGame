services:
  pc-server:
    build: ../../
    command: pc run --non-interactive
    ports:
      - "${PC_SERVER_PORT}:${PC_SERVER_PORT}"
    environment:
      - ASPNETCORE_URLS=http://0.0.0.0:${PC_SERVER_PORT}
      - DOTNET_ENVIRONMENT=E2E
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${PC_SERVER_PORT}/api/boards"]
      interval: 10s
      timeout: 10s
      retries: 5
      start_period: 30s
  board1:
    build: ../../
    command: board run
    ports:
      - "${BOARD1_PORT}:${BOARD1_PORT}"
    environment:
      - ASPNETCORE_URLS=http://0.0.0.0:${BOARD1_PORT}
      - DOTNET_ENVIRONMENT=E2E
      - BoardNetworkSettings__PcServerAddress=http://${PC_SERVER_HOST}:${PC_SERVER_PORT}
      - BoardNetworkSettings__BoardAddress=http://${BOARD1_HOST}:${BOARD1_PORT}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${BOARD1_PORT}/api/board/health"]
      interval: 10s
      timeout: 10s
      retries: 5
      start_period: 30s
  board2:
    build: ../../
    command: board run
    ports:
      - "${BOARD2_PORT}:${BOARD2_PORT}"
    environment:
      - ASPNETCORE_URLS=http://0.0.0.0:${BOARD2_PORT}
      - DOTNET_ENVIRONMENT=E2E
      - BoardNetworkSettings__PcServerAddress=http://${PC_SERVER_HOST}:${PC_SERVER_PORT}
      - BoardNetworkSettings__BoardAddress=http://${BOARD2_HOST}:${BOARD2_PORT}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${BOARD2_PORT}/api/board/health"]
      interval: 10s
      timeout: 10s
      retries: 5
      start_period: 30s
